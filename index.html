<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【日替わり】名言・格言集｜人生・成功の教訓と深掘り解説</title>
    
    <!-- ファビコンの追加 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💡</text></svg>">
    
    <!-- メタタグ（Description, Keywords）の追加 -->
    <meta name="description" content="厳選された歴史上の名言と、その背景・意味を深く解説。毎日を豊かにする教訓が見つかります。">
    <meta name="keywords" content="名言,格言,自己啓発,人生,成功,仕事術,習慣化,モチベーション,リーダーシップ,深掘り解説,日めくり,タグ検索">

    <!-- OGPタグ（SNSシェア最適化）の追加 -->
    <meta property="og:title" content="【今日の教訓】日替わり名言・格言集と徹底解説">
    <meta property="og:description" content="厳選名言を深掘り解説。モチベーション向上、自己啓発に。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://[あなたのサイトURL]/index.html"> 
    <meta property="og:image" content="https://placehold.co/1200x630/4f46e5/ffffff?text=MEIGEN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@meigen_bot"> 
    
    <!-- Tailwind CSS CDNをロード -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (UI用のInter, 名言用のNoto Serif JP) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Serif+JP:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate 100 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-container {
            max-width: 48rem; /* 幅を広げ、より多くの情報を表示 */
            width: 100%;
        }

        /* 名言用のフォントを適用 */
        #quote-text {
            font-family: 'Noto Serif JP', serif;
            font-size: 1.5rem; /* 24px */
            line-height: 2.25rem; /* 36px */
            font-weight: 400;
            min-height: 100px; 
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 120px; /* CLS対策 */
        }
        
        /* 著者用のフォント */
        #quote-author {
            font-family: 'Inter', sans-serif;
            font-size: 1rem; /* 16px */
        }

        /* フッターを下に固定 */
        footer {
            margin-top: auto;
            width: 100%;
            max-width: 48rem;
            padding-top: 20px;
            text-align: center;
        }

        /* トランジションのカスタムクラス */
        .fade-in {
            transition: opacity 0.3s ease-in-out;
        }

        /* 通知ボックスのスタイル */
        #notification-box {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* CLS対策: 解説エリアの最低高さを確保 */
        #explanation-area {
            min-height: 150px; 
        }
    </style>
    
    <!-- 広告コードの挿入場所 1: AdSense認証スクリプト (HEAD内) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6721819057047925"
     crossorigin="anonymous"></script>
     
    <!-- Google CMP 同意管理コード -->
    <script async src="https://fundingchoicesmessages.google.com/i/pub-6721819057047925?cmp_v=2" nonce=""></script>
    <script>
        (function() {
            function handleGmpu() {
                if (!window.frames['__gmpuframe']) {
                    var iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.name = '__gmpuframe';
                    document.body.appendChild(iframe);
                }
            }
            handleGmpu();
        })();
    </script>
    
    <!-- JSON-LD 構造化データの追加 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "【日替わり】名言・格言集｜人生・成功の教訓と深掘り解説",
      "description": "厳選された名言と、その背景・意味を深く解説。毎日を豊かにする教訓が見つかります。",
      "url": "https://[あなたのサイトURL]/index.html", 
      "inLanguage": "ja",
      "mainContentOfPage": {
        "@type": "Article",
        "headline": "名言・格言集",
        "datePublished": "2024-01-01", 
        "author": {
          "@type": "Organization",
          "name": "格言ジェネレーター"
        }
      }
    }
    </script>

</head>
<body>

<div class="main-container bg-white p-8 sm:p-12 rounded-2xl shadow-xl mb-4">
    
    <!-- H1タグ -->
    <h1 class="text-3xl font-bold text-center mb-4 text-indigo-600">
        日替わり 名言・格言集
    </h1>
    
    <!-- 現在のフィルタリング状態を表示するエリア -->
    <div id="filter-status" class="text-center mb-6 min-h-[30px]">
        <span id="current-filter-tag" class="text-sm font-medium text-gray-500">
            すべての教訓からランダムに表示中 <span class="text-xs text-gray-400">(タグをクリックで絞り込み)</span>
        </span>
    </div>
    
    <!-- 名言表示エリア -->
    <div class="mb-8 min-h-[150px]">
        <blockquote class="relative">
            <!-- 引用符（左） -->
            <span class="absolute -left-4 -top-6 text-8xl text-gray-200 opacity-50 select-none">“</span>
            
            <!-- 名言テキスト -->
            <p id="quote-text" class="mb-4 text-gray-800 font-normal fade-in">
                「今日の教訓を見る」ボタンを押して、新しい名言を表示しましょう。
            </p>
            
            <!-- 引用符（右） -->
            <span class="absolute -right-4 -bottom-10 text-8xl text-gray-200 opacity-50 select-none">”</span>
        </blockquote>
        
        <!-- タグ表示エリア -->
        <div id="tags-container" class="flex justify-center flex-wrap gap-2 mt-4 fade-in min-h-[28px]">
            <!-- タグバッジがJavaScriptで挿入される -->
        </div>

        <p id="quote-author" class="text-right text-gray-600 font-medium mt-4 pr-4 fade-in">
            —
        </p>
    </div>
    
    <!-- 操作ボタンエリア -->
    <div class="flex flex-col sm:flex-row gap-4 mt-6 w-full">
        <!-- 名言表示ボタン -->
        <button id="generate-btn" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full transition-all duration-300 transform hover:scale-[1.03] shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 relative">
            <span id="button-text">今日の教訓を見る</span>
        </button>
        <!-- シェアボタン -->
        <button id="share-btn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-full transition-all duration-300 transform hover:scale-[1.03] shadow-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50" disabled>
            名言をシェア
        </button>
    </div>
    
    <!-- 解説エリア (H2タグ) -->
    <div class="mt-4 pt-4 border-t border-gray-200">
        <h2 class="text-xl font-semibold text-gray-700 mb-3 text-center">名言の深掘り解説</h2>
        
        <!-- 解説表示エリア -->
        <div id="explanation-area" class="bg-gray-50 p-4 rounded-xl shadow-inner min-h-[150px] flex flex-col justify-center items-center">
            <p id="explanation-text" class="text-gray-700 text-sm leading-relaxed text-left">
                「今日の教訓を見る」ボタンを押すと、厳選された名言に対する解説文が表示されます。
            </p>
        </div>
    </div>
    
    <!-- Amazonリンク表示エリア -->
    <div id="recommendation-area" class="mt-8 pt-4 border-t border-gray-200 text-center hidden fade-in">
        <p class="text-sm font-semibold text-gray-600 mb-3">今日の教訓をさらに深める：</p>
        <!-- リンクはJavaScriptで動的に挿入されます -->
        <div id="recommendation-links" class="flex flex-wrap justify-center gap-2">
            <!-- 著者リンクとテーマ別リンクがここに入る -->
        </div>
    </div>
    
    <!-- 広告コードの挿入場所 2: ボトムバナー広告 (BODY内) -->
    <div class="mx-auto max-w-md mt-8 p-3 bg-gray-50 border border-gray-200 rounded-lg text-center shadow-inner min-h-[100px]">
        <p class="text-xs font-bold text-gray-500 mb-2">【広告枠】</p>
        
        <!-- AdSense広告ユニットコード: 名言格言下部バナー -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-6721819057047925"
             data-ad-slot="3484248774"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

</div>

<!-- 静的で高品質なコンテンツの追加 -->
<div class="main-container bg-white p-8 sm:p-12 rounded-2xl shadow-xl mt-4">
    <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2 border-indigo-100">
        💡 「今日の一言」が人生を変える理由
    </h2>
    <p class="text-gray-600 text-sm mb-4 leading-relaxed">
        この名言・格言集は、歴史上の偉人や成功者たちが残した普遍的な知恵を厳選し、お届けします。
        成功とは、一瞬の閃きではなく、毎日の小さな行動と正しいマインドセットの積み重ねによって達成されます。
        私たちは、ただの名言を紹介するだけでなく、その背景にある深い**教訓**と、それを**あなたの現代の生活や仕事に応用する方法**を徹底的に解説しています。
    </p>
    <p class="text-gray-600 text-sm mb-4 leading-relaxed">
        **【主なテーマ】**
        <ul class="list-disc list-inside ml-4 text-sm text-gray-700 space-y-1 mt-2">
            <li>自己啓発・成長: 習慣化、モチベーション維持、自己肯定感を高める教訓。</li>
            <li>仕事術・リーダーシップ: 決断力、時間管理、チームでの協力と戦略立案。</li>
            <li>人生哲学・幸福論: 失敗への向き合い方、変化への適応、心の平和を見つける方法。</li>
        </ul>
    </p>
    <p class="text-gray-600 text-sm leading-relaxed italic border-t pt-3 mt-4">
        毎朝、新しい名言に触れることで、あなたの思考はリフレッシュされ、行動へのエネルギーが生まれます。さあ、あなたも今日の教訓を見つけて、人生の新たな一歩を踏み出しましょう。
    </p>
</div>
<!-- /静的で高品質なコンテンツの追加 -->


<footer>
    <div class="text-sm text-gray-500 space-x-4">
        <a href="privacy.html" class="hover:underline text-indigo-600">プライバシーポリシー</a>
        <a href="terms.html" class="hover:underline text-indigo-600">利用規約</a>
        <span class="text-gray-400">|</span>
        <span class="text-gray-500">当サイトはAmazon.co.jpアソシエイトに参加しています。</span>
    </div>
</footer>

<!-- 1. 通知ボックス (画面下中央に固定表示) -->
<div id="notification-box" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 p-3 bg-gray-900 text-white text-sm rounded-lg shadow-2xl opacity-0 transition-opacity duration-300 pointer-events-none z-50">
    <span id="notification-message"></span>
</div>

<!-- 2. 共有モーダル (画面中央に表示) -->
<div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-40 modal-leave-to" style="display: none;">
    <div class="bg-white p-6 rounded-2xl shadow-2xl max-w-sm w-full mx-4 transform transition-all">
        <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">名言をシェアする</h3>
        
        <!-- モーダル内で共有テキストをプレビュー -->
        <div class="bg-indigo-50 p-3 rounded-lg text-sm text-gray-700 mb-4 border border-indigo-200">
            <p id="modal-quote-preview" class="font-medium italic text-center"></p>
        </div>

        <div class="flex flex-col gap-3">
            <!-- Twitter 共有ボタン (JS制御) -->
            <button id="share-twitter-btn" class="flex items-center justify-center gap-3 bg-blue-400 hover:bg-blue-500 text-white font-bold py-3 rounded-full transition duration-200 transform hover:scale-[1.02] shadow-md">
                <!-- Twitter Icon (Inline SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.901 1.153h3.586l-8.73 10.04h10.89l-14.61 9.92h-3.66l8.89-10.22h-10.89z"/></svg>
                Twitter (X) でシェア
            </button>

            <!-- LINE 共有ボタン (JS制御) -->
            <button id="share-line-btn" class="flex items-center justify-center gap-3 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-full transition duration-200 transform hover:scale-[1.02] shadow-md">
                <!-- LINE Icon (Inline SVG Placeholder) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M11.96 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm4.332 17.618h-8.583c-.341 0-.616-.275-.616-.615v-8.583c0-.341.275-.616.616-.616h8.583c.341 0 .615.275.615.616v8.583c0 .341-.274.615-.615.615z"/></svg>
                LINE で友だちに送る
            </button>

            <!-- テキストコピーボタン -->
            <button id="copy-text-btn" class="flex items-center justify-center gap-3 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 rounded-full transition duration-200 transform hover:scale-[1.02] shadow-md">
                <!-- Copy Icon (Inline SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                【解説付き】全文をコピー
            </button>
        </div>

        <button id="close-modal-btn" class="mt-4 w-full text-sm text-gray-500 hover:text-gray-800 transition duration-200">
            閉じる
        </button>
    </div>
</div>

<script>
    // ===================================
    // 1. 固定データとグローバル変数
    // ===================================
    
    // 【重要】固定の名言データ配列
    let ALL_QUOTES = [
        {
            quote: "成功とは、失敗を恐れずに挑戦し続ける能力である。",
            author: "ウィンストン・チャーチル",
            tags: ["挑戦", "失敗", "継続"],
            explanation: "チャーチルは、成功の秘訣は一度の勝利ではなく、何度失敗しても諦めずに立ち向かう精神力にあると説きました。この教訓は、今日のビジネス環境におけるイノベーションや、新しいスキル習得にそのまま応用できます。失敗は終わりではなく、次へのステップとして捉えましょう。"
        },
        {
            quote: "考えるのは難しい。だからこそ、ほとんどの人は判断する。",
            author: "カール・ユング",
            tags: ["思考", "哲学", "決断"],
            explanation: "深く考えることはエネルギーを使いますが、人はすぐに結論（判断）に飛びつきがちです。ユングの言葉は、安易な判断を下す前に、一度立ち止まって本質的な問題は何かを深く掘り下げることの重要性を教えてくれます。特に重要な経営判断や人生の選択において役立つ教訓です。"
        },
        {
            quote: "完璧を目指すな。完成させろ。",
            author: "マーク・ザッカーバーグ",
            tags: ["実行", "スピード", "仕事術"],
            explanation: "Facebookの創業者であるザッカーバーグの言葉は、特にITやスタートアップの業界で重視されます。完璧を追求するあまり、市場への投入が遅れることの機会損失を警告しています。まずは「完成」させて世に出し、フィードバックを得ながら「完璧」に近づけるアジャイルな姿勢が、現代の成功には不可欠です。"
        },
        {
            quote: "最も重要なことは、自分自身をコントロールすることだ。",
            author: "プラトン",
            tags: ["自己制御", "習慣化", "哲学"],
            explanation: "古代ギリシャの哲学者プラトンは、外的な富や権力ではなく、内的な自己の感情や欲望を律することこそが、真の幸福と成功の基盤だと考えました。この教訓は、衝動的な消費や感情的な意思決定を避け、長期的な目標達成に向けた習慣を築く上で、極めて重要な指針となります。"
        },
        {
            quote: "幸福とは、能力と現実の要求が一致している状態である。",
            author: "ジョン・F・ケネディ",
            tags: ["幸福", "仕事術", "目標"],
            explanation: "ケネディ大統領が語る幸福論は、自己の持つ才能や能力が、社会や仕事から求められている課題を解決する時に、最も大きな満足感が得られるということを示しています。自分の強みを活かし、それを必要としている場所を見つけることが、キャリアと人生の充足に繋がります。"
        },
        {
            quote: "100回叩くと壊れる壁でも、皆が99回まで叩いている。",
            author: "本田宗一郎",
            tags: ["努力", "継続", "モチベーション"],
            explanation: "ホンダの創業者である本田宗一郎の言葉は、成功と失敗の境界線が「あと一歩」の粘り強さにあることを示唆しています。多くの人が挫折する99回目でやめてしまうところを、100回目に到達するまで続ける意思が、競争優位性となります。最後の粘りが重要です。"
        },
        {
            quote: "想像力は知識よりも重要である。",
            author: "アルベルト・アインシュタイン",
            tags: ["創造性", "思考", "イノベーション"],
            explanation: "アインシュタインは、既存の知識も大切だが、新しい何かを生み出すための想像力こそが、人類の進歩の源泉であると考えました。この言葉は、既存の枠組みにとらわれず、自由な発想で課題解決に取り組むこと、つまりイノベーションを起こすためのマインドセットの重要性を説いています。"
        },
        {
            quote: "変化こそが人生の不変の法則である。",
            author: "ソクラテス",
            tags: ["変化", "適応", "哲学"],
            explanation: "古代からの教訓でありながら、現代のテクノロジー時代に最も当てはまる言葉の一つです。ビジネスも人生も常に変化しており、この事実を受け入れ、自らも変化に適応していく能力が生き残るために必須です。変化を恐れず、むしろ楽しむ姿勢が求められます。"
        },
        {
            quote: "あなたが変えられるのは、あなたの努力だけだ。",
            author: "ネルソン・マンデラ",
            tags: ["努力", "自己責任", "行動"],
            explanation: "南アフリカの元大統領マンデラの言葉は、他人の行動や環境を変えようとする無駄な努力をやめ、唯一コントロール可能な「自分の努力と行動」に集中することの重要性を教えてくれます。外部環境のせいにせず、自律的に行動する力を養いましょう。"
        },
        {
            quote: "最も大きな危険は、目標が高すぎることではなく、低すぎることである。",
            author: "ミケランジェロ",
            tags: ["目標設定", "挑戦", "ビジョン"],
            explanation: "ルネサンスの巨匠ミケランジェロは、人の能力は目標の高さによって引き出されると信じていました。達成できないかもしれないと恐れて目標を低く設定するよりも、壮大なビジョンを持つことで、想像以上の力を発揮できることを示唆しています。常にストレッチ目標を設定しましょう。"
        },
        {
            quote: "他人の生き方を真似しても、成功は得られない。",
            author: "ココ・シャネル",
            tags: ["個性", "自己理解", "独自性"],
            explanation: "ファッション界のレジェンド、シャネルの言葉は、自分自身の個性と価値観に根ざした生き方を追求することの重要性を強調しています。流行や他人の成功体験を盲目的に追いかけるのではなく、独自のスタイルを確立することこそが、真の成功と幸福に繋がる道です。"
        },
        {
            quote: "人生は短い。今日できることを明日まで延ばすな。",
            author: "パブロ・ピカソ",
            tags: ["時間管理", "実行", "プロアクティブ"],
            explanation: "偉大な芸術家ピカソのこの言葉は、生産性向上に直結する教訓です。先延ばしは最大の敵であり、今日という一日、今という瞬間が持つ価値を最大限に活かすよう促しています。タスクは小さく分解し、「今すぐ実行」を心がけましょう。"
        },
        {
            quote: "逆境こそ、人が真に試される機会だ。",
            author: "ウォルト・ディズニー",
            tags: ["逆境", "成長", "レジリエンス"],
            explanation: "ディズニーの成功は数々の失敗と困難の上に築かれました。逆境に直面した時こそ、その人の真価、そしてレジリエンス（精神的回復力）が問われます。困難を避けるのではなく、それを成長のための最高の試練として受け入れるマインドセットが、偉業を成す鍵です。"
        },
        {
            quote: "習慣こそが、人生のすべてを決定する。",
            author: "アリストテレス",
            tags: ["習慣化", "基礎", "自己成長"],
            explanation: "哲学の祖アリストテレスは、人間の行動や性格は一時的な出来事ではなく、日々の習慣によって形作られると見ていました。成功は、派手なイベントの結果ではなく、質の高い習慣の積み重ねによって決まります。目標達成のためには、まず小さな良い習慣から作りましょう。"
        },
        {
            quote: "自分のしていることに自信を持て。それが成功の第一歩だ。",
            author: "トーマス・エジソン",
            tags: ["自信", "モチベーション", "行動"],
            explanation: "発明王エジソンは、自らのアイデアや製品に対する揺るぎない確信が、困難な研究開発を続ける原動力になったことを知っています。自信は単なる感情ではなく、行動を促し、他者を説得する力となります。まずは自分の選択を信じ、堂々と行動しましょう。"
        },
        {
            quote: "成功の秘訣は、常に目的を持ち続けることだ。",
            author: "スティーブ・ジョブズ",
            tags: ["目的", "ビジョン", "継続"],
            explanation: "アップルの共同創業者ジョブズは、製品開発においても経営においても、明確な「なぜ？」を持つことの重要性を説きました。目的（パーパス）がブレなければ、一時的な失敗や市場の変化にも動じず、真に価値のあるものを作り続けることができます。あなたの目的は何ですか？"
        },
        {
            quote: "他者から期待されること以上に、自分が期待することを目指せ。",
            author: "ジョージ・バーナード・ショー",
            tags: ["自己基準", "独立", "挑戦"],
            explanation: "他人の期待に応えることは社会生活において重要ですが、それだけでは自己の成長が止まります。バーナード・ショーは、自分自身が設定した高い基準（自己期待）を達成することこそが、真のモチベーションと成果に繋がると示唆します。自分の内なる声に耳を傾けましょう。"
        },
        {
            quote: "あなたが今日話す言葉が、明日のあなたの人生を作る。",
            author: "オプラ・ウィンフリー",
            tags: ["言葉", "ポジティブ思考", "習慣"],
            explanation: "メディア界の女王オプラは、言葉の力が現実を創造すると信じています。ネガティブな言葉はネガティブな現実を、ポジティブで建設的な言葉は成功と幸福を引き寄せます。日々の口癖や内なる独り言に意識を向け、使う言葉を変えることから人生を変えていきましょう。"
        }
    ];

    let currentQuoteData = null; // 現在表示中の名言データを保持
    let fullShareText = ""; // コピーボタン用に整形されたフルテキストを保持
    let shortShareText = ""; // SNS/Web Share API用に整形されたテキストを保持
    
    // 【新規】フィルタリング関連の変数
    let filteredQuotes = ALL_QUOTES; // 初期値は全名言
    let currentFilterTag = null; // 現在選択中のタグ
    
    // DOM要素
    const quoteTextElement = document.getElementById('quote-text');
    const quoteAuthorElement = document.getElementById('quote-author');
    const generateBtn = document.getElementById('generate-btn');
    const shareBtn = document.getElementById('share-btn'); 
    const recommendationArea = document.getElementById('recommendation-area'); 
    const recommendationLinksContainer = document.getElementById('recommendation-links');
    const tagsContainer = document.getElementById('tags-container'); 
    const explanationTextElement = document.getElementById('explanation-text'); 
    const notificationBox = document.getElementById('notification-box'); 
    const notificationMessage = document.getElementById('notification-message'); 
    const filterStatusElement = document.getElementById('current-filter-tag'); // フィルタ状態表示要素

    
    // モーダル関連DOM要素
    const shareModal = document.getElementById('share-modal');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const modalQuotePreview = document.getElementById('modal-quote-preview');
    const shareTwitterBtn = document.getElementById('share-twitter-btn');
    const shareLineBtn = document.getElementById('share-line-btn'); 
    const copyTextBtn = document.getElementById('copy-text-btn');

    // AmazonアソシエイトID
    const AFFILIATE_TAG = 'yamano32010e-22'; 
    
    // コピー時に使用する固定URL
    const FIXED_SHARE_URL = window.location.href; 
    
    // ===================================
    // 2. ユーティリティ関数
    // ===================================

    /**
     * 画面下部に通知メッセージを表示する
     */
    function showNotification(message) {
        notificationMessage.textContent = message;
        notificationBox.style.opacity = 1;
        
        setTimeout(() => {
            notificationBox.style.opacity = 0;
        }, 3000);
    }

    /**
     * 著者とテーマに基づき、Amazonで検索すべきキーワードとボタンテキストを決定する
     */
    function updateRecommendation(quoteData) {
        const { tags, author } = quoteData;

        // 1. 著者名からのリンク (最優先)
        const authorUrl = `https://www.amazon.co.jp/s?k=${encodeURIComponent(author)}&tag=${AFFILIATE_TAG}`; 
        const authorLinkHtml = `
            <a href="${authorUrl}" target="_blank" rel="noopener noreferrer" class="text-xs sm:text-sm bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-2 px-3 rounded-full transition duration-200 shadow-md transform hover:scale-[1.05] whitespace-nowrap">
                ${author} の関連書籍を見る
            </a>
        `;
        
        // 2. タグに基づいたテーマ別リンク
        let keyword = "自己啓発書";
        let label = "関連書籍";

        if (tags.includes("仕事術") || tags.includes("リーダーシップ")) {
            keyword = "リーダーシップ マネジメント 自己啓発";
            label = "リーダーシップ論";
        } else if (tags.includes("習慣化") || tags.includes("継続")) {
            keyword = "習慣化 トラッカー 成功法則";
            label = "習慣化・成功法則";
        } else if (tags.includes("失敗") || tags.includes("挑戦")) {
            keyword = "失敗を恐れない 挑戦 マインドセット";
            label = "挑戦のマインドセット";
        } else if (tags.includes("幸福") || tags.includes("哲学")) {
            keyword = "ウェルビーイング マインドフルネス 幸福論";
            label = "メンタルヘルス・幸福論";
        }

        const themeUrl = `https://www.amazon.co.jp/s?k=${encodeURIComponent(keyword)}&tag=${AFFILIATE_TAG}`;
        const themeLinkHtml = `
            <a href="${themeUrl}" target="_blank" rel="noopener noreferrer" class="text-xs sm:text-sm bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-3 rounded-full transition duration-200 shadow-md transform hover:scale-[1.05] whitespace-nowrap">
                テーマ: ${label} 関連商品
            </a>
        `;

        recommendationLinksContainer.innerHTML = authorLinkHtml + themeLinkHtml;
        recommendationArea.classList.remove('hidden');
    }

    /**
     * テキストをクリップボードにコピーする処理
     */
    async function copyToClipboard(text) {
        // execCommandを使ったコピー処理
        const tempInput = document.createElement('textarea');
        tempInput.value = text;
        tempInput.style.position = 'absolute';
        tempInput.style.left = '-9999px';
        tempInput.style.opacity = 0; 
        document.body.appendChild(tempInput);
        
        tempInput.focus();
        tempInput.select();
        tempInput.setSelectionRange(0, 99999); 
        
        let copySuccess = false;
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showNotification('名言と解説をコピーしたよ！');
                copySuccess = true;
            } else {
                throw new Error('execCommand failed');
            }
        } catch (err) {
            console.error('Copy failed:', err);
            showNotification('コピーに失敗しちゃった...手動でコピーしてみてね。');
        } finally {
            document.body.removeChild(tempInput);
        }
        
        return copySuccess;
    }

    // ===================================
    // 3. コンテンツの表示とフィルタリング
    // ===================================
    
    /**
     * ランダムな名言を選択し、UIを更新する
     * フィルタリング状態に応じて、filteredQuotesまたはALL_QUOTESから選択する
     */
    function displayRandomQuote() {
        // フィルタリングされたリスト、または全てのリストから選択
        const quotesToDrawFrom = filteredQuotes.length > 0 ? filteredQuotes : ALL_QUOTES;

        if (quotesToDrawFrom.length === 0) {
            // 名言がない場合の処理
            quoteTextElement.textContent = "このテーマの名言は現在ありません。フィルタを解除してみてください。";
            quoteAuthorElement.textContent = "—";
            tagsContainer.innerHTML = '';
            explanationTextElement.textContent = "フィルタリングされたリストに一致する名言がありませんでした。";
            shareBtn.disabled = true;
            recommendationArea.classList.add('hidden');
            return;
        }

        // ランダムに名言を選択
        const randomIndex = Math.floor(Math.random() * quotesToDrawFrom.length);
        const quoteData = quotesToDrawFrom[randomIndex];
        currentQuoteData = quoteData; 

        // --- STEP 1: テキストの入れ替えと表示 ---
        quoteTextElement.textContent = quoteData.quote;
        quoteAuthorElement.textContent = `— ${quoteData.author}`;
        
        // タグの表示 (フィルタ状態を反映)
        displayTags(quoteData.tags);

        // 解説文を表示
        explanationTextElement.textContent = quoteData.explanation.trim();

        // レコメンドリンクの更新
        updateRecommendation(quoteData);
        
        // シェアテキストの更新
        setupShareText(quoteData);

        // フェードイン
        quoteTextElement.style.opacity = 1;
        quoteAuthorElement.style.opacity = 1;
        tagsContainer.style.opacity = 1; 
        recommendationArea.style.opacity = 1;
        explanationTextElement.style.opacity = 1;
        shareBtn.disabled = false;
        
        // フィルタリング中でない場合のみ通知
        if (!currentFilterTag) {
            showNotification('今日の教訓を表示しました！');
        }
    }
    
    /**
     * 名言に付与されたタグをバッジとして表示する（クリックイベント追加）
     */
    function displayTags(tags) {
        tagsContainer.innerHTML = ''; 
        if (!tags || tags.length === 0) return;
        tags.forEach(tag => {
            const isCurrentFilter = tag === currentFilterTag;
            const tagElement = document.createElement('span');
            tagElement.textContent = `#${tag}`;
            
            // スタイルを設定
            let tagClass = 'text-xs font-semibold px-3 py-1 rounded-full shadow-sm whitespace-nowrap fade-in cursor-pointer transition duration-150';
            
            if (isCurrentFilter) {
                // フィルタリング中のタグ (解除アクション)
                tagClass += ' bg-indigo-600 text-white hover:bg-indigo-700 ring-2 ring-indigo-300';
            } else {
                // 通常のタグ (絞り込みアクション)
                tagClass += ' bg-indigo-100 text-indigo-700 hover:bg-indigo-200';
            }
            
            tagElement.className = tagClass;
            tagElement.dataset.tag = tag; // データ属性にタグ名を保存
            
            // クリックイベントを追加
            tagElement.addEventListener('click', () => filterQuotesByTag(tag));
            
            tagsContainer.appendChild(tagElement);
        });
    }


    /**
     * 指定されたタグで名言をフィルタリングし、表示を更新する
     * @param {string} tag - フィルタリングに使用するタグ名
     */
    function filterQuotesByTag(tag) {
        let message = '';

        if (tag === currentFilterTag) {
            // 同じタグがクリックされた場合は、フィルタを解除
            currentFilterTag = null;
            filteredQuotes = ALL_QUOTES;
            filterStatusElement.innerHTML = `すべての教訓からランダムに表示中 <span class="text-xs text-gray-400">(タグをクリックで絞り込み)</span>`;
            message = 'フィルタリングを解除しました。';
        } else {
            // 新しいタグでフィルタリング
            currentFilterTag = tag;
            filteredQuotes = ALL_QUOTES.filter(q => q.tags.includes(tag));
            
            if (filteredQuotes.length > 0) {
                filterStatusElement.innerHTML = `「<span class="text-indigo-600 font-bold">#${tag}</span>」に関連する<span class="text-indigo-600 font-bold">${filteredQuotes.length}件</span>の教訓から表示中`;
                message = `「#${tag}」で教訓を絞り込みました。`;
            } else {
                // タグで絞り込まれた結果がない場合
                currentFilterTag = null;
                filteredQuotes = ALL_QUOTES;
                filterStatusElement.innerHTML = `すべての教訓からランダムに表示中 <span class="text-xs text-red-600 font-bold">(一致する名言がありませんでした)</span>`;
                message = `申し訳ありません。「#${tag}」に一致する名言は見つかりませんでした。`;
            }
        }
        
        // フィルタリング後のリストから名言を再表示
        displayRandomQuote();
        showNotification(message);
    }
    
    /**
     * 共有用およびコピー用のテキストを整形し、グローバル変数に設定する
     */
    function setupShareText(quoteData) {
        const { quote, author, explanation, tags } = quoteData;

        // 1. 動的なハッシュタグ生成
        const tagStrings = (tags || []).filter(t => t).map(tag => `#${tag}`);
        const fixedTags = ["#名言", "#今日の格言", "#自己成長"];
        const uniqueTagsString = Array.from(new Set([...tagStrings, ...fixedTags])).join(' ');
        
        // コピー用フルテキスト (解説文、ハッシュタグ、URLを含む)
        fullShareText = `
【日替わり：今日の名言と深掘り解説】

「${quote}」
— ${author}

解説:
${explanation}

${uniqueTagsString}

👇あなたの日々の行動力を高める教訓はこちら
${FIXED_SHARE_URL}
        `.trim();

        // Web Share APIの 'url' パラメータでリンクが自動的に付与されるため、URLは含めない
        shortShareText = `
【日替わり：今日の名言】
「${quote}」
— ${author}

${uniqueTagsString}
        `.trim(); 

        // モーダル内のプレビューを設定 (名言と著者のみ)
        modalQuotePreview.textContent = `"${quote}" — ${author}`; 
    }
    
    // ===================================
    // 4. モーダル操作と共有処理
    // ===================================

    /**
     * メインのシェアボタンの処理: Native Share APIがあればそれを使用。なければモーダルを開く。
     */
    function handleMainShare() {
        if (!currentQuoteData) {
            showNotification('名言がまだ表示されていません。');
            return;
        }

        if (navigator.share) {
            navigator.share({
                title: '【日替わり：今日の名言】',
                text: shortShareText,
                url: FIXED_SHARE_URL, 
            })
            .then(() => showNotification('ネイティブ共有ダイアログを開いたよ！'))
            .catch((error) => {
                // AbortErrorはユーザーがキャンセルした場合なので無視し、それ以外はモーダルを開く
                if (error.name !== 'AbortError') {
                    openShareModal(); 
                }
            });
        } else {
            openShareModal();
        }
    }

    /**
     * 共有モーダルを開く
     */
    function openShareModal() {
        if (!currentQuoteData) return;
        setupShareText(currentQuoteData);
        
        shareModal.style.display = 'flex';
        // アニメーションの開始
        setTimeout(() => {
            shareModal.classList.remove('modal-leave-to');
        }, 10);
    }

    /**
     * 共有モーダルを閉じる
     */
    function closeShareModal() {
        shareModal.classList.add('modal-leave-to');
        // アニメーション完了後に非表示
        setTimeout(() => {
            shareModal.style.display = 'none';
        }, 300);
    }

    /**
     * Twitterでシェアする
     */
    function shareOnTwitter() {
        if (!currentQuoteData) return;
        const twitterText = encodeURIComponent(shortShareText);
        const twitterUrl = `https://twitter.com/intent/tweet?text=${twitterText}&url=${encodeURIComponent(FIXED_SHARE_URL)}`;
        window.open(twitterUrl, '_blank', 'noopener,noreferrer');
        closeShareModal();
    }

    /**
     * LINEでシェアする
     */
    function shareOnLine() {
        if (!currentQuoteData) return;
        const lineTextWithUrl = shortShareText + '\n\n' + FIXED_SHARE_URL;
        const lineTextEncoded = encodeURIComponent(lineTextWithUrl);
        // LINEアプリを開くためのリンク
        window.location.href = `https://line.me/R/msg/text/?${lineTextEncoded}`;
        closeShareModal(); 
    }


    // ===================================
    // 5. イベントリスナーと初期化
    // ===================================

    // 「今日の教訓を見る」ボタン: 名言表示
    generateBtn.addEventListener('click', displayRandomQuote);

    // 「名言をシェア」ボタン 
    shareBtn.addEventListener('click', handleMainShare);

    // モーダル関連イベントリスナー
    closeModalBtn.addEventListener('click', closeShareModal);
    // モーダルのオーバーレイクリックで閉じる
    shareModal.addEventListener('click', (e) => {
        if (e.target === shareModal) {
            closeShareModal();
        }
    });
    shareTwitterBtn.addEventListener('click', shareOnTwitter);
    shareLineBtn.addEventListener('click', shareOnLine);
    copyTextBtn.addEventListener('click', async () => {
        const success = await copyToClipboard(fullShareText); 
        if (success) {
            closeShareModal();
        }
    });

    // ページロード時の初期設定
    document.addEventListener('DOMContentLoaded', () => {
        // 初回ロード時には、まず生成ボタンを押してもらうように促す
        shareBtn.disabled = true;
    });
</script>

</body>
</html>


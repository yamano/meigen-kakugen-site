<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>名言・格言集 - 今日の教訓</title>
    
    <!-- Tailwind CSS CDNをロード -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (UI用のInter, 名言用のNoto Serif JP) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Serif+JP:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate 100 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 10vh;
            padding: 20px;
        }
        
        .main-container {
            max-width: 48rem; /* 幅を広げ、より多くの情報を表示 */
            width: 100%;
        }

        /* 名言用のフォントを適用 */
        #quote-text {
            font-family: 'Noto Serif JP', serif;
            font-size: 1.5rem; /* 24px */
            line-height: 2.25rem; /* 36px */
            font-weight: 400;
            min-height: 100px; 
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        /* 著者用のフォント */
        #quote-author {
            font-family: 'Inter', sans-serif;
            font-size: 1rem; /* 16px */
        }

        /* フッターを下に固定 */
        footer {
            margin-top: auto;
            width: 100%;
            max-width: 48rem;
            padding-top: 20px;
            text-align: center;
        }

        /* トランジションのカスタムクラス */
        .fade-in {
            transition: opacity 0.3s ease-in-out;
        }

        /* 通知ボックスのスタイル */
        #notification-box {
            transition: opacity 0.3s ease-in-out;
        }

        /* モーダルのアニメーション */
        .modal-enter-active, .modal-leave-active {
            transition: opacity 0.3s;
        }
        .modal-enter-from, .modal-leave-to {
            opacity: 0;
        }
    </style>
    
    <!-- ======================================================================= -->
    <!-- ========= 広告コードの挿入場所 1: AdSense認証スクリプト (HEAD内) ========= -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6721819057047925"
     crossorigin="anonymous"></script>
     
    <!-- 【Google CMP 同意管理コード】 -->
    <script async src="https://fundingchoicesmessages.google.com/i/pub-6721819057047925?cmp_v=2" nonce=""></script>
    <script>
        (function() {
            function handleGmpu() {
                if (!window.frames['__gmpuframe']) {
                    var iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.name = '__gmpuframe';
                    document.body.appendChild(iframe);
                }
            }
            handleGmpu();
        })();
    </script>
    <!-- ======================================================================= -->

</head>
<body>

<div class="main-container bg-white p-8 sm:p-12 rounded-2xl shadow-xl mb-4">
    
    <h1 class="text-3xl font-bold text-center mb-8 text-indigo-600">
        名言・格言集
    </h1>
    
    <!-- 名言表示エリア -->
    <div class="mb-8 min-h-[150px]">
        <blockquote class="relative">
            <!-- 引用符（左） -->
            <span class="absolute -left-4 -top-6 text-8xl text-gray-200 opacity-50 select-none">“</span>
            
            <p id="quote-text" class="mb-4 text-gray-800 font-normal fade-in">
                新しい名言を生成ボタンを押して、今日の教訓を見つけましょう。
            </p>
            
            <!-- 引用符（右） -->
            <span class="absolute -right-4 -bottom-10 text-8xl text-gray-200 opacity-50 select-none">”</span>
        </blockquote>
        
        <!-- タグ表示エリア -->
        <div id="tags-container" class="flex justify-center flex-wrap gap-2 mt-4 fade-in min-h-[28px]">
            <!-- タグバッジがJavaScriptで挿入される -->
        </div>

        <p id="quote-author" class="text-right text-gray-600 font-medium mt-4 pr-4 fade-in">
            — ジェネレーター
        </p>
    </div>
    
    <!-- LLMによる解説エリア -->
    <div class="mt-4 pt-4 border-t border-gray-200">
        <h2 class="text-xl font-semibold text-gray-700 mb-3 text-center">名言の解説</h2>
        
        <!-- 解説ローディング/表示エリア -->
        <div id="explanation-area" class="bg-gray-50 p-4 rounded-xl shadow-inner min-h-[100px] flex flex-col justify-center items-center">
            <p id="explanation-text" class="text-gray-700 text-sm leading-relaxed text-center">
                <!-- 解説テキストがここに挿入されます -->
            </p>
        </div>
    </div>
    
    <!-- Amazonリンク表示エリア -->
    <div id="recommendation-area" class="mt-8 pt-4 border-t border-gray-200 text-center hidden fade-in">
        <p class="text-sm font-semibold text-gray-600 mb-3">今日の教訓をさらに深める：</p>
        <!-- リンクはJavaScriptで動的に挿入されます -->
        <div id="recommendation-links" class="flex flex-wrap justify-center gap-2">
            <!-- 著者リンクとテーマ別リンクがここに入る -->
        </div>
    </div>
    
    <!-- 操作ボタン -->
    <div class="flex flex-col sm:flex-row gap-4 mt-6 w-full">
        <!-- ページリロードボタン -->
        <button id="generate-btn" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full transition-all duration-300 transform hover:scale-[1.03] shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
            新しい名言を生成
        </button>
        <!-- シェアボタン -->
        <button id="share-btn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-full transition-all duration-300 transform hover:scale-[1.03] shadow-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50">
            名言をシェア
        </button>
    </div>

    
    <!-- ======================================================================= -->
    <!-- ========= 広告コードの挿入場所 2: ボトムバナー広告 (BODY内) ========= -->
    <div class="mx-auto max-w-md mt-8 p-3 bg-gray-50 border border-gray-200 rounded-lg text-center shadow-inner">
        <p class="text-xs font-bold text-gray-500 mb-2">【広告枠】</p>
        
        <!-- 【AdSense広告ユニットコード: 名言格言下部バナー】 -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-6721819057047925"
             data-ad-slot="3484248774"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
    <!-- ======================================================================= -->

</div>

<footer>
    <div class="text-sm text-gray-500 space-x-4">
        <!-- **重要**: リンク先は privacy.html, terms.html に設定済みです -->
        <a href="privacy.html" class="hover:underline text-indigo-600">プライバシーポリシー</a>
        <a href="terms.html" class="hover:underline text-indigo-600">利用規約</a>
        <span class="text-gray-400">|</span>
        <!-- Amazonアソシエイトの規約に基づく表示 -->
        <span class="text-gray-500">当サイトはAmazon.co.jpアソシエイトに参加しています。</span>
    </div>
</footer>

<!-- 1. 通知ボックス (画面下中央に固定表示) -->
<div id="notification-box" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 p-3 bg-gray-900 text-white text-sm rounded-lg shadow-2xl opacity-0 transition-opacity duration-300 pointer-events-none z-50">
    <span id="notification-message"></span>
</div>

<!-- 2. 共有モーダル (画面中央に表示) -->
<div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-40 modal-leave-to" style="display: none;">
    <div class="bg-white p-6 rounded-2xl shadow-2xl max-w-sm w-full mx-4 transform transition-all">
        <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">名言をシェアする</h3>
        
        <!-- モーダル内で共有テキストをプレビュー -->
        <!-- ここでは短い共有テキストをプレビューとして表示 -->
        <div class="bg-indigo-50 p-3 rounded-lg text-sm text-gray-700 mb-4 border border-indigo-200">
            <p id="modal-quote-preview" class="font-medium italic text-center"></p>
        </div>

        <div class="flex flex-col gap-3">
            <!-- Twitter 共有ボタン (JS制御) -->
            <button id="share-twitter-btn" class="flex items-center justify-center gap-3 bg-blue-400 hover:bg-blue-500 text-white font-bold py-3 rounded-full transition duration-200 transform hover:scale-[1.02] shadow-md">
                <!-- Twitter Icon (Inline SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.901 1.153h3.586l-8.73 10.04h10.89l-14.61 9.92h-3.66l8.89-10.22h-10.89z"/></svg>
                Twitter (X) でシェア
            </button>

            <!-- LINE 共有ボタン (JS制御) -->
            <button id="share-line-btn" class="flex items-center justify-center gap-3 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-full transition duration-200 transform hover:scale-[1.02] shadow-md">
                <!-- LINE Icon (Inline SVG Placeholder) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M11.96 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm4.332 17.618h-8.583c-.341 0-.616-.275-.616-.615v-8.583c0-.341.275-.616.616-.616h8.583c.341 0 .615.275.615.616v8.583c0 .341-.274.615-.615.615z"/></svg>
                LINE で友だちに送る
            </button>

            <!-- テキストコピーボタン -->
            <button id="copy-text-btn" class="flex items-center justify-center gap-3 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 rounded-full transition duration-200 transform hover:scale-[1.02] shadow-md">
                <!-- Copy Icon (Inline SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                【解説付き】全文をコピー
            </button>
        </div>

        <button id="close-modal-btn" class="mt-4 w-full text-sm text-gray-500 hover:text-gray-800 transition duration-200">
            閉じる
        </button>
    </div>
</div>

<script>
    // ===================================
    // 1. 名言データの配列 (口語調に修正)
    // ===================================
    const quotes = [
        { quote: "道は近きにあり、而もこれを遠きに求む。", author: "孟子", tags: ["哲学", "人生", "思考"], explanation: "孟子（もうし）の言葉ですね。本当に大切な真理や幸せは、遠い場所ではなく、実は自分の毎日の生活の中や心の中に既にある、という教えです。外にばかり答えを探すのではなく、まず自分を見つめ直すことが大切なんですね。" },
        { quote: "失敗とは、より賢くやり直すための良い機会である。", author: "ヘンリー・フォード", tags: ["仕事", "成功", "失敗", "挑戦"], explanation: "自動車王フォードは、失敗をネガティブに捉えませんでした。むしろ、成功するための貴重な学びの機会だと考えていたんですね。どこが悪かったのかをしっかり把握し、次に活かすことが、より賢い行動に繋がる、という前向きなメッセージです。" },
        { quote: "我々の最大の弱点は諦めることにある。成功する最も確実な方法は、常にもう一回だけ試してみることだ。", author: "トーマス・エジソン", tags: ["努力", "成功", "失敗", "挑戦"], explanation: "多くの発明をしたエジソンの成功哲学ですね。成功するか失敗するかの分かれ道は、能力の違いではなく、どれだけ粘り強く『諦めない心』を持てるかにある、ということを教えてくれています。" },
        { quote: "今日という日は、残りの人生の最初の日である。", author: "チャールズ・ディードリッヒ", tags: ["人生", "時間", "行動"], explanation: "過去に縛られず、「今」が常に新しいスタート地点なんだよ、と教えてくれる言葉です。何かを始めるのに『もう遅い』なんてことはありません。毎日が未来を創る最高のチャンスだと、私たちを励ましてくれますね。" },
        { quote: "幸福は、すでに出来上がっているものではない。それは自らの行動によってもたらされる。", author: "ダライ・ラマ14世", tags: ["幸福", "行動", "哲学", "精神"], explanation: "幸せは誰かから与えられるものではなく、自分の行動の結果として作り上げられる、という教えです。積極的な行動や良い選択を積み重ねることが、心の平和や喜びを生み出す源になる、というメッセージが込められています。" },
        { quote: "夢見ることができれば、それは実現できる。", author: "ウォルト・ディズニー", tags: ["夢", "成功", "創造"], explanation: "世界的なエンターテイメントを築いたディズニーの、信念の言葉です。まず、心の中で明確なビジョン（夢）を描くことができれば、必ずそれを現実に変えることができる、という創造的な行動の第一歩を示しています。" },
        { quote: "自分自身を信じてみるだけでいい。きっと、生きる道が見えてくる。", author: "ゲーテ", tags: ["自信", "哲学", "人生"], explanation: "ドイツの文豪ゲーテの言葉は、自己信頼の力を教えてくれます。不安や迷いがある時こそ、外の声ではなく自分の直感を信じてみること。そうすれば、前に進むべき道が自然と見えてくるはずだよ、という温かいメッセージです。" },
        { quote: "人生は自転車に乗るようなものだ。倒れないようにするには、走り続けなければならない。", author: "アルベルト・アインシュタイン", tags: ["人生", "時間", "行動", "成長"], explanation: "アインシュタインが、運動の法則を人生に例えた、とても分かりやすい言葉です。人生でバランスを保ち、前に進むためには、立ち止まらずに常に学び、努力し続けることが欠かせない、という教訓を伝えています。" },
        { quote: "小さなことを積み重ねることが、とんでもないところへ行くただひとつの道だ。", author: "イチロー", tags: ["努力", "習慣", "仕事", "成長"], explanation: "イチロー選手が実践してきた、成功への哲学です。大きな目標を達成するには、いきなり大それたことをするのではなく、日々の細かい作業や習慣を、粘り強く積み重ねていくことこそが唯一の王道なんだ、というメッセージです。" },
        { quote: "他人と比較して、他人が自分より優れていたとしても、それは恥ではない。しかし、去年の自分より今年の自分が優れていないのは、大いに恥である。", author: "ジョン・ラボック", tags: ["成長", "自己肯定", "反省"], explanation: "他人と比べることにエネルギーを使うのはもったいない、と教えてくれます。本当に大切なのは、今日の自分が過去の自分と比べて成長しているかどうか。常に『昨日の自分』をライバルとして、自己改善を続けることの価値を強調しています。" },
        { quote: "努力は必ず報われる。もし報われないのなら、それはまだ努力と呼べない。", author: "野村克也", tags: ["努力", "仕事", "野球", "根性"], explanation: "名将・野村克也氏の、厳しくも愛のある言葉です。結果が出ないのは単に運が悪いのではなく、それはまだ『真の努力』になっていないということ。目的意識を持って、戦略的に、諦めずにやり抜くことの大切さを教えてくれています。" },
        { quote: "人生は一冊の書物のようなものだ。愚か者はパラパラとめくり、賢い者は熟読する。", author: "アガサ・クリスティ", tags: ["人生", "読書", "ミステリー", "学習"], explanation: "人生という時間を、ぼーっと過ごすのではなく、深く考えて、学び、経験をしっかりと消化することの価値を表現しています。表面だけを見て通り過ぎるのではなく、時間をかけて内省することが、人生の真実を理解する鍵だというメッセージです。" },
        { quote: "人間は考える葦である。", author: "ブレーズ・パスカル", tags: ["哲学", "思考", "本質"], explanation: "17世紀の思想家パスカルの有名な言葉です。「葦（あし）」のように弱く頼りない存在の人間が、宇宙の中で最も優れているのは『考える力』を持っているからだ、と説いています。私たちは弱いけれど、思考の力で偉大な存在になれるんですね。" },
        { quote: "天才とは努力の別名である。", author: "羽生善治", tags: ["努力", "思考", "将棋", "天才"], explanation: "将棋界のレジェンド、羽生善治氏の言葉です。生まれ持った才能よりも、地道で絶え間ない努力を続けることこそが、非凡な結果を生み出す真の源なんだ、と努力の価値を最大限に肯定してくれています。" },
        { quote: "未来とは、今である。未来に備える最善の方法は、今を最高の瞬間として生きることだ。", author: "デイル・カーネギー", tags: ["未来", "時間", "行動"], explanation: "自己啓発の大家カーネギーは、未来は遠いものではなく、現在の行動の延長線上にあると言っています。何かを始めるのに『もう遅い』なんてことはありません。毎日が未来を創る最高のチャンスだと、私たちを励ましてくれますね。" },
        { quote: "最も大切なことは、人生を楽しむこと。幸せを感じること。", author: "オードリー・ヘップバーン", tags: ["幸福", "人生", "女優", "美"], explanation: "世界的な女優オードリー・ヘップバーンが遺した、人生に対する純粋な視点です。名声やキャリアよりも、日々の生活の中で小さな喜びや感謝を見つけ、幸せを感じることこそが人生のゴールだよ、という彼女らしい優しいメッセージです。" },
        { quote: "過去を悔やむより、未来を恐れるより、今を生きなさい。", author: "マザー・テレサ", tags: ["過去", "今", "奉仕", "精神"], explanation: "マザー・テレサのこの言葉は、私たちを苦しめる「後悔」と「不安」から解放される方法を教えてくれます。過去や未来に囚われず、目の前の瞬間に集中し、今できる奉仕や行動に心を尽くすことこそが、心の平和につながるんですね。" },
        { quote: "どんなに遠くへ行く時も、最初の一歩は自分の足元から始まる。", author: "老子", tags: ["哲学", "始まり", "行動"], explanation: "古代中国の思想家、老子の教えです。どんなに壮大で困難な目標でも、必ず身近で小さな行動からスタートする、という行動の原理を示しています。大きな変化を起こすには、まず勇気を出して最初の一歩を踏み出すことが必要なんですね。" },
        { quote: "もし今日が人生最後の日だとしたら、今からやろうとしていることをやりたいだろうか？", author: "スティーブ・ジョブズ", tags: ["仕事", "思考", "決断"], explanation: "アップル創業者のジョブズが、人生の価値観を問う強烈な問いかけです。私たちが日々している選択が、本当に自分の心からの情熱と一致しているか？後悔しない人生を送るための指針を、常にチェックすることを促してくれます。" },
        { quote: "困難に打ち勝つために、最も必要なのは一時の勇気ではなく、日々の習慣である。", author: "アリストテレス (意訳)", tags: ["習慣", "努力", "哲学", "成長"], explanation: "偉大な人格や功績は、一瞬の才能や努力ではなく、日々の正しい行動や習慣を継続することによって作られる、というアリストテレスの哲学を現代的に解釈したものです。毎日の小さな習慣の力が、困難を乗り越える鍵なんですね。" },
        { quote: "学ぶことをやめたら、立ち止まったことになる。", author: "山本五十六", tags: ["学習", "成長", "仕事", "知識"], explanation: "連合艦隊司令長官であった山本五十六の言葉は、常に自分を磨き続けることの大切さを示しています。変化の激しい時代に、今持っている知識だけで満足せず、一生涯学び続ける姿勢こそが、停滞を避ける唯一の道だという教訓です。" },
        { quote: "人を信じよ、しかしその百倍も自らを信じよ。", author: "手塚治虫", tags: ["創造", "自信", "漫画", "芸術"], explanation: "「漫画の神様」手塚治虫が遺した、強いクリエイターとしての信念です。人との協調も大切ですが、最終的に作品を生み出す責任とビジョンは自分自身にあります。自己の才能と決断を強く信じることが、独自の作品を生む原動力になるんですね。" },
        { quote: "知識の追求は、人生における最も素晴らしい冒険だ。", author: "アルバート・シュバイツァー", tags: ["知識", "学習", "冒険", "科学"], explanation: "医師であり神学者のシュバイツァーは、知的好奇心を満たす旅を人生最高の冒険だと語っています。新しいことを学び、世界への理解を深めるプロセスは、肉体的な冒険にも負けないほど興奮と発見に満ちている、という知識の喜びを教えてくれます。" },
        { quote: "成功の反対は失敗ではない。何もしないことだ。", author: "ブライアン・トレーシー", tags: ["行動", "成功", "挑戦"], explanation: "成功の専門家トレーシーは、行動することの絶対的な重要性を説いています。失敗は行動した結果であり、学びの機会ですが、一番ダメなのは、失敗を恐れて何も行動しないことだ、と私たちに強く訴えかけています。" },
        { quote: "希望は、目覚めている人間が見る夢だ。", author: "アリストテレス", tags: ["希望", "夢", "哲学"], explanation: "アリストテレスは、希望を単なる非現実的な願望ではなく、実現可能な未来への強い意志として捉えました。希望は、私たちを行動へと駆り立てる原動力であり、現実を動かす力を持っている、というポジティブな意味合いが込められています。" },
        { quote: "何かを始めるためには、やめることからはじめなければならない。", author: "ピーター・ドラッカー", tags: ["仕事", "思考", "マネジメント", "変化"], explanation: "マネジメントの父ドラッカーの、新しい挑戦への哲学です。新しいことを始める時の最大の壁は、すでに持っているリソース（時間やエネルギー）が古い活動に奪われていること。効果的に前進するには、まず不要なものを手放す『捨てる勇気』が必要だよ、という教えです。" },
        { quote: "人生とは、今日一日のことである。", author: "稲盛和夫", tags: ["仕事", "人生", "経営"], explanation: "京セラの創業者である稲盛和夫氏の経営哲学です。どんなに大きな成果も、結局は今日の地道な努力の積み重ねでしかありません。過去や未来を心配するのではなく、今日という一日に、ただひたむきに全力を尽くすことの重要性を説いています。" },
        { quote: "人生に失敗がないと、人生を失敗する。", author: "斎藤茂太", tags: ["失敗", "人生", "経験"], explanation: "精神科医、斎藤茂太氏による、失敗を避けすぎる人生への警鐘です。失敗や挫折を経験することは、人間的な深みや優しさを育む上で欠かせません。失敗のない人生は、結果として、何か大切なものを学べず終わってしまうかもしれない、というメッセージです。" },
        { quote: "最も速く進むものは、一人で進むものだ。最も遠くまで行くものは、皆で進むものだ。", author: "アフリカの諺", tags: ["チーム", "協力", "コミュニティ"], explanation: "短期的な目標達成は一人でできますが、長く、大きな成功を目指すなら、仲間との協力が不可欠だというアフリカの知恵です。チームワークやコミュニティの力が、最終的に私たちをより遠い場所へと連れて行ってくれるんですね。" },
        { quote: "流行は廃れるが、スタイルは永遠。", author: "ココ・シャネル", tags: ["美", "スタイル", "ファッション", "永遠"], explanation: "ファッション界の巨匠、ココ・シャネルの言葉です。一時的な流行に流されるのではなく、個人の内面から生まれる普遍的な美意識や個性を磨くことの価値を説いています。自分らしいスタイルこそが、時代を超えて輝き続けるんですね。" },
        { quote: "天才とは、１％のひらめきと、９９％の努力である。", author: "トーマス・エジソン", tags: ["努力", "天才", "成功"], explanation: "エジソンの最も有名な言葉ですが、これは「努力」だけでなく「ひらめき」も必要だということです。しかし、そのひらめきが現実になるには、圧倒的な努力がなければ不可能である、という努力の価値を強調する言葉ですね。" },
        { quote: "自分の生きる人生を愛せ。自分の愛する人生を生きろ。", author: "ボブ・マーリー", tags: ["人生", "幸福", "音楽", "平和"], explanation: "レゲエの神様、ボブ・マーリーの力強いメッセージです。社会のルールや他人の期待に縛られず、自分が心から望む生き方を選び、その人生を愛して生きることが、真の幸せに繋がるんだよ、という自由への願望が込められています。" },
        { quote: "未来を予測する最善の方法は、それを創り出すことだ。", author: "ピーター・ドラッカー", tags: ["未来", "創造", "仕事", "マネジメント"], explanation: "ドラッカーは、「未来は待つものじゃなくて、自分たちの行動で能動的に作るものだ」という哲学を提唱しました。未来への不安を感じるより、今すぐ行動を起こして、自分の望む未来を創り始めることが大事なんですね。" },
        { quote: "想像力は知識よりも重要である。", author: "アルベルト・アインシュタイン", tags: ["想像力", "科学", "知識"], explanation: "科学者アインシュタインが、既存の知識よりも想像力を重視したのは、なぜでしょう？ 知識は過去の経験ですが、想像力は新しい世界を創り出す原動力だからです。人類の進歩には、無限の想像力が不可欠だと考えていたんですね。" },
        { quote: "人生とは、あなたが計画を立てている間に起こるものだ。", author: "ジョン・レノン", tags: ["人生", "計画", "音楽", "変化"], explanation: "ビートルズのジョン・レノンが残した、人生の予期せぬ側面に光を当てる言葉です。人生は計画通りにはいかないけれど、予期せぬ出来事や出会いこそが、人生の真の喜びや試練をもたらすんだ、という変化を受け入れる哲学を示しています。" },
        { quote: "人の価値は、その人が得たものではなく、その人が与えたもので測られる。", author: "アルベルト・アインシュタイン", tags: ["価値", "奉仕", "精神"], explanation: "人の本当の価値は、どれだけ財産や地位といった『所有』があるかではなく、社会や他人にどれだけ貢献し『与えた』か、という行動の質によって決まる、というアインシュタインの考えです。利己心ではなく、奉仕の精神こそが大切なんですね。" },
        { quote: "すべての夢は、それを実現しようと試みる勇気があるなら叶う。", author: "ウォルト・ディズニー", tags: ["夢", "勇気", "挑戦"], explanation: "夢を実現するには、ただ願うだけでなく、それを現実にするための『一歩を踏み出す勇気』と『挑戦し続ける行動力』が絶対に必要なんだ、という力強いメッセージです。夢と現実をつなぐのは、私たち自身の勇気なんですね。" },
        { quote: "最高の復讐は、素晴らしい成功を収めることだ。", author: "フランク・シナトラ", tags: ["成功", "挑戦"], explanation: "歌手フランク・シナトラのこの言葉は、ネガティブな感情を、自己成長のエネルギーに変えるべきだと教えてくれます。誰かを恨んだり攻撃したりするよりも、圧倒的な成功を収めることこそが、最も洗練された反論になる、という考え方です。" },
        { quote: "人生にリハーサルはない。", author: "チャールズ・チャップリン", tags: ["人生", "今", "時間"], explanation: "喜劇王チャップリンの言葉は、人生がやり直しのきかない、たった一度の舞台であることを示しています。だからこそ、すべての瞬間を大切にして、後悔のないように真剣に生きることの価値を強調していますね。" },
        { quote: "天は人の上に人をつくらず、人の下に人をつくらず。", author: "福沢諭吉", tags: ["哲学", "平等", "学習"], explanation: "『学問のすゝめ』の冒頭にある、非常に有名な言葉です。生まれながらの身分や差はない、という平等思想を説いています。ただし、その後の差は「学問をしたかしないか」によって生じる、として、学習の重要性を強く訴えかけました。" },
        { quote: "迷ったときには、より困難な道を選べ。", author: "アボット・ローレンス・ロウエル", tags: ["決断", "挑戦", "成長"], explanation: "ハーバード大学の学長を務めたロウエルの教えです。安易な道を選ぶのではなく、あえて挑戦的で難しい道を選ぶことの価値を強調しています。困難な道は、より多くの学びと成長の機会を与えてくれるんですね。" },
        { quote: "本当に大切なものは目に見えない。", author: "アントワーヌ・ド・サン＝テグジュペリ", tags: ["哲学", "愛", "本質", "読書"], explanation: "『星の王子さま』に出てくる、とても感動的なフレーズです。友情、愛情、誠実さといった、人生で最も価値のあるものは、物質的なものではなく、心で感じる精神的なものである、と教えてくれます。表面的なものに惑わされず、本質を見抜く目を持ちたいですね。" },
        { quote: "もし飛びたければ、手放さなければならないものがいくつかある。", author: "オノ・ヨーコ", tags: ["解放", "変化", "人生"], explanation: "アーティストのオノ・ヨーコが残した、変化と自己実現に関する言葉です。新しい高みを目指すためには、過去の古い習慣や、自分を縛り付けている重荷を、勇気を出して手放す決断が必要なんだ、というメッセージです。" },
        { quote: "一番大切なことは、一番大切なことを一番大切にすることだ。", author: "スティーブン・コヴィー", tags: ["習慣", "仕事", "時間", "マネジメント"], explanation: "『7つの習慣』の著者コヴィーの、優先順位に関する哲学です。緊急ではないけれど、人生において本当に重要な事柄（一番大切なこと）に、意識的に時間を使うことが、効果的な人生を送るための秘訣だと説かれています。" },
        { quote: "真の富とは、どれだけ持っているかではなく、どれだけ与えられるかだ。", author: "ブッダ", tags: ["富", "哲学", "宗教", "精神"], explanation: "ブッダの教えは、物質的な豊かさよりも、精神的な豊かさと他者への慈悲の心を大切にしています。分かち合いや奉仕の行為こそが、人間に最も深い充足感と幸福をもたらす真の財産だと示しています。" },
        { quote: "学ぶのは簡単だ。だが、身につけた知識や習慣を捨てるのは難しい。", author: "ソクラテス", tags: ["学習", "哲学", "習慣", "思考"], explanation: "新しい知識を覚えるよりも、昔からの間違った考え方や非効率な習慣を捨てる方が、人間にとってはるかに難しい、という人間の本質を突いた言葉です。真の学習は、まず自分の既成概念を疑うことから始まるのかもしれません。" },
        { quote: "行動する前に十分考える時間をとろう。しかし、行動する時が来たら、考えるのをやめて進め。", author: "ナポレオン・ボナパルト", tags: ["行動", "決断", "仕事"], explanation: "フランスの軍事指導者ナポレオンによる、思考と実行のバランスを示す言葉です。計画段階では慎重に分析し、一度決めたら、もう迷わず全力で実行に移すことの重要性を説いています。" },
        { quote: "私は特別なことは何もしていない。ただ、人よりも長く問題と向き合っていただけだ。", author: "アルベルト・アインシュタイン", tags: ["努力", "科学", "思考"], explanation: "アインシュタインのこの言葉は、彼の偉大な業績が、生来の才能だけでなく、誰よりも粘り強く、深く、一つの問題に集中し続けた努力の結果であることを教えてくれます。偉業の裏には、膨大な時間と精神的な集中力があったんですね。" },
        { quote: "過去は変えられないが、未来は今変えられる。", author: "ジェームズ・ディーン", tags: ["未来", "行動", "変化"], explanation: "俳優ジェームズ・ディーンのこの言葉は、過去の失敗や後悔にとらわれず、現在の自分の行動こそが未来の結果を決定するんだ、という強いメッセージです。今この瞬間が、運命を変える唯一のチャンスだということを教えてくれます。" },
        { quote: "成功とは、熱意を失わずに失敗から失敗へと渡り歩く能力である。", author: "ウィンストン・チャーチル", tags: ["成功", "失敗", "根性"], explanation: "イギリスの首相チャーチルによる、成功の定義です。失敗はプロセスの一部であり、大切なのは、失敗するたびに情熱を再燃させて、次の挑戦へと進む粘り強さなんだ、と教えてくれています。" },
        { quote: "他人の意見で、自分の内側の声がかき消されないようにしなさい。", author: "スティーブ・ジョブズ", tags: ["自信", "思考", "創造"], explanation: "ジョブズが残した、自己の直感と信念を貫くことの大切さを説く言葉です。真の革新や創造性は、既存の意見に流されず、自分自身の情熱と直感を信じる、強い精神から生まれるんだ、という信念を表明しています。" },
        { quote: "幸せになる秘訣は、自分がしたいことをすることではなく、しなければならないことをすることに幸せを見出すことだ。", author: "ジェームス・M・バリ", tags: ["幸福", "仕事", "人生"], explanation: "『ピーター・パン』の作者バリのこの言葉は、義務や責任を重荷として捉えるのではなく、その仕事や役割の中に喜びや意味を見出すことの重要性を教えてくれます。目の前のやるべきことに積極的に関わる姿勢が、真の幸福感に繋がるんですね。" },
        { quote: "生きるとは、自分自身と闘うことだ。", author: "太宰治", tags: ["人生", "文学", "精神"], explanation: "日本の文豪、太宰治のこの言葉は、人生の本質が、外部との闘いよりも内面的な葛藤にあることを示唆しています。自分の中の弱さや、理想と現実のギャップと向き合い続けることこそが、『生きる』という行為なんだ、という深いメッセージです。" },
        { quote: "世の中に、無駄なものなんて何一つないよ。", author: "さくらももこ", tags: ["人生", "肯定", "幸福"], explanation: "漫画家さくらももこ氏の、日常への優しい眼差しが伝わる言葉です。一見ネガティブに見える経験や、小さな出来事も、すべてが人生の彩りや教訓になっている。全ての存在を肯定してくれる、温かい哲学が込められています。" },
        { quote: "すべては実験である。", author: "野口英世", tags: ["挑戦", "科学", "行動"], explanation: "細菌学者であった野口英世の、科学者としての精神を表した言葉です。人生や研究におけるすべての試みや経験を、成功か失敗かではなく、結果から学ぶための『実験』として捉えることで、恐れずに挑戦し続ける姿勢の大切さを説いています。" },
        { quote: "逆境こそ、真の友を知る最高の試練である。", author: "シェイクスピア", tags: ["友情", "挑戦", "人間関係"], explanation: "イギリスの劇作家シェイクスピアの言葉は、順調な時には見えにくい人間の本質が、困難や逆境に直面したときにこそ明らかになる、と教えてくれます。本当の友情や信頼できる仲間は、苦しい状況でこそその価値を発揮するんですね。" },
        { quote: "人生は短い。だからこそ、自分の信じた道を貫くべきだ。", author: "宮沢賢治", tags: ["人生", "文学", "精神"], explanation: "『銀河鉄道の夜』などで知られる宮沢賢治の、生きる姿勢に関する言葉です。限られた人生の時間を、他者の価値観ではなく、自らが信じる理想や使命のために捧げ、一途に生きることの尊さを伝えています。" },
        { quote: "人生で最も重要なことは、いかに生きるべきかを学ぶことだ。", author: "セネカ", tags: ["学習", "哲学", "習慣"], explanation: "古代ローマの哲学者セネカの教えです。知識やお金の獲得よりも、どうやって徳高く、幸福に生きるかという『生き方』そのものを学び、実践することこそが、人生における最高の目的だと説かれています。" },
        { quote: "すべてを変える必要はない。必要なのは、考え方を変えることだけだ。", author: "ジグ・ジグラー", tags: ["思考", "変化"], explanation: "モチベーションスピーカーであるジグラーのこの言葉は、自分の人生の状況を変えたいなら、外部の環境を変えるよりも、まず内面的なものの見方や態度を変えることが、最も効果的だと教えてくれます。思考の変化が、現実の変化の鍵なんですね。" },
        { quote: "目標は達成するためにあるのではなく、方向性を示すためにある。", author: "ブルース・リー", tags: ["目標", "哲学", "行動"], explanation: "武術家ブルース・リーの、目標設定に対する考え方です。目標に固執しすぎず、その目標が示す方向へ向かうプロセスや、それによって自分が成長することこそが重要なんだ、という哲学を表現しています。" },
        { quote: "賢者は、自分で考えていることを言う。愚者は、言おうと思っていることを自分で考えていると思う。", author: "プラトン", tags: ["思考", "哲学", "知識"], explanation: "古代ギリシャの哲学者プラトンによる、思考と発言の関係性に関する鋭い洞察です。賢い人は言葉を発する前に思考をしっかり整理しますが、愚かな人は、浅い考えを深い思考と勘違いしてしまう、という知的謙虚さの重要性を示しています。" }
    ];

    // ===================================
    // 2. グローバル変数とDOM要素の取得
    // ===================================
    let currentQuoteData = null; // 現在表示中の名言データを保持
    let fullShareText = ""; // コピーボタン用に整形されたフルテキストを保持 (解説文を含む)
    let shortShareText = ""; // SNS/Web Share API用に整形されたテキストを保持 (解説文とハッシュタグを含む)

    const quoteTextElement = document.getElementById('quote-text');
    const quoteAuthorElement = document.getElementById('quote-author');
    const generateBtn = document.getElementById('generate-btn');
    const shareBtn = document.getElementById('share-btn'); 
    const recommendationArea = document.getElementById('recommendation-area'); 
    const recommendationLinksContainer = document.getElementById('recommendation-links');
    const tagsContainer = document.getElementById('tags-container'); 
    const explanationTextElement = document.getElementById('explanation-text'); 
    const notificationBox = document.getElementById('notification-box'); 
    const notificationMessage = document.getElementById('notification-message'); 

    // モーダル関連DOM要素
    const shareModal = document.getElementById('share-modal');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const modalQuotePreview = document.getElementById('modal-quote-preview');
    const shareTwitterBtn = document.getElementById('share-twitter-btn');
    const shareLineBtn = document.getElementById('share-line-btn'); 
    const copyTextBtn = document.getElementById('copy-text-btn');

    // AmazonアソシエイトID
    const AFFILIATE_TAG = 'yamano32010e-22'; 
    
    // コピー時に使用する固定URL
    const FIXED_SHARE_URL = window.location.href; // 現在のURLを取得するように変更

    // ===================================
    // 3. ユーティリティ関数
    // ===================================

    /**
     * quotes配列からランダムに一つの名言オブジェクトを取得する
     */
    function getRandomQuote() {
        const randomIndex = Math.floor(Math.random() * quotes.length);
        return quotes[randomIndex];
    }

    /**
     * 画面下部に通知メッセージを表示する
     */
    function showNotification(message) {
        notificationMessage.textContent = message;
        notificationBox.style.opacity = 1;
        
        setTimeout(() => {
            notificationBox.style.opacity = 0;
        }, 3000);
    }

    /**
     * タグに基づき、Amazonで検索すべきキーワードとボタンテキストを決定する
     */
    function getThemeRecommendation(tags) {
        if (tags.includes("仕事") && tags.includes("マネジメント")) {
            return { keyword: "リーダーシップ マネジメント本", label: "リーダーシップ論" };
        }
        if (tags.includes("努力") && tags.includes("習慣")) {
            return { keyword: "習慣化 トラッカー ダイアリー", label: "習慣・目標管理グッズ" };
        }
        if (tags.includes("失敗") && tags.includes("挑戦")) {
            return { keyword: "失敗から学ぶ 成功事例", label: "失敗学・挑戦の記録" };
        }
        if (tags.includes("幸福") && tags.includes("精神")) {
            return { keyword: "マインドフルネス 瞑想グッズ", label: "メンタルヘルス・幸福論" };
        }
        if (tags.includes("読書") || tags.includes("知識")) {
            return { keyword: "読書術 速読 読解力", label: "読書術・アウトプット" };
        }
        if (tags.includes("美") || tags.includes("ファッション") || tags.includes("女優")) {
            return { keyword: "ファッション スタイル 美容本", label: "美容・スタイルアップ" };
        }
        if (tags.includes("哲学") || tags.includes("本質")) {
            return { keyword: "古典名著 哲学入門書", label: "哲学・人生の古典" };
        }
        
        if (tags.includes("仕事") || tags.includes("成功")) {
            return { keyword: "ビジネス 自己啓発書", label: "ビジネス・成功" };
        }
        if (tags.includes("人生") || tags.includes("時間")) {
            return { keyword: "ライフハック タイムマネジメント", label: "時間・人生設計" };
        }
        if (tags.includes("創造") || tags.includes("芸術")) {
            return { keyword: "クリエイティブ 思考法", label: "創造性・アイデア発想" };
        }

        return { keyword: "名言 格言集", label: "名言関連商品" };
    }

    /**
     * 名言に付与されたタグをバッジとして表示する
     */
    function displayTags(tags) {
        tagsContainer.innerHTML = ''; 
        tags.forEach(tag => {
            const tagElement = document.createElement('span');
            tagElement.textContent = `#${tag}`;
            tagElement.className = 'text-xs font-semibold px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full shadow-sm whitespace-nowrap fade-in';
            tagsContainer.appendChild(tagElement);
        });
    }

    /**
     * 著者とテーマに基づくレコメンドリンクを生成・表示する
     */
    function updateRecommendation(quote) {
        const { author, tags } = quote;
        
        // 1. 著者検索リンクの作成
        const authorUrl = `https://www.amazon.co.jp/s?k=${encodeURIComponent(author)}&tag=${AFFILIATE_TAG}`; 
        const authorLinkHtml = `
            <a href="${authorUrl}" target="_blank" rel="noopener noreferrer" class="text-xs sm:text-sm bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-2 px-3 rounded-full transition duration-200 shadow-md transform hover:scale-[1.05] whitespace-nowrap">
                ${author} の関連書籍を見る
            </a>
        `;

        // 2. テーマ別レコメンドリンクの作成
        const themeRec = getThemeRecommendation(tags);
        const themeUrl = `https://www.amazon.co.jp/s?k=${encodeURIComponent(themeRec.keyword)}&tag=${AFFILIATE_TAG}`;
        const themeLinkHtml = `
            <a href="${themeUrl}" target="_blank" rel="noopener noreferrer" class="text-xs sm:text-sm bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-3 rounded-full transition duration-200 shadow-md transform hover:scale-[1.05] whitespace-nowrap">
                テーマ: ${themeRec.label} 関連商品
            </a>
        `;

        recommendationLinksContainer.innerHTML = authorLinkHtml + themeLinkHtml;
        recommendationArea.classList.remove('hidden');
    }

    /**
     * テキストをクリップボードにコピーする処理
     */
    async function copyToClipboard(text) {
        let copySuccess = false;

        // 1. モダンAPI (navigator.clipboard.writeText) の試行
        if (navigator.clipboard && window.isSecureContext) {
            try {
                await navigator.clipboard.writeText(text);
                // ★ 口語表現に修正
                showNotification('名言と解説をコピーしたよ！'); 
                copySuccess = true;
            } catch (err) {
                // 失敗した場合、フォールバック（document.execCommand）へ進む
            }
        }

        // 2. フォールバック: document.execCommand('copy')
        if (!copySuccess) {
            const tempInput = document.createElement('textarea');
            tempInput.value = text;
            tempInput.style.position = 'absolute';
            tempInput.style.left = '-9999px';
            tempInput.style.opacity = 0; 
            document.body.appendChild(tempInput);
            
            tempInput.focus();
            tempInput.select();
            tempInput.setSelectionRange(0, 99999); 
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    // ★ 口語表現に修正
                    showNotification('名言と解説をコピーしたよ！');
                    copySuccess = true;
                } else {
                    throw new Error('execCommand failed');
                }
            } catch (err) {
                // ★ 口語表現に修正
                showNotification('コピーに失敗しちゃった...手動でコピーしてみてね。');
            } finally {
                document.body.removeChild(tempInput);
            }
        }
        return copySuccess;
    }

    // ===================================
    // 4. シェアテキスト設定関数 (長文ショート版に修正)
    // ===================================

    /**
     * 共有用およびコピー用のテキストを整形し、グローバル変数に設定する
     */
    function setupShareText(quoteData) {
        const { quote, author, explanation } = quoteData;

        // 1. 動的なハッシュタグ生成 (名言格言に使われている物を優先)
        const tags = quoteData.tags.filter(t => t).map(tag => `#${tag}`);
        const fixedTags = ["#名言", "#今日の格言"];
        // 引用元のタグと固定タグをマージして重複を排除し、文字列に変換
        const uniqueTagsString = Array.from(new Set([...tags, ...fixedTags])).join(' ');
        
        // ★★★ 変更: コピー用フルテキスト (解説文、ハッシュタグ、URLを含む) ★★★
        fullShareText = `
【今日の名言と解説】

「${quote}」
— ${author}

名言の解説:
${explanation}

${uniqueTagsString}

👇他の名言や解説も見てみませんか？
${FIXED_SHARE_URL}
        `.trim();

        // ★★★ Web Share / Twitter / LINE用 テキスト (解説文、ハッシュタグ、口語CTAを含む) ★★★
        // URLはSNS APIの引数として渡すため、テキストには含めず、CTAの文言のみを記載する。
        shortShareText = `
【今日の名言と解説】

「${quote}」
— ${author}

名言の解説:
${explanation}

${uniqueTagsString}

👇他の名言や解説も見てみませんか？
        `.trim(); 

        // モーダル内のプレビューを設定 (名言と著者のみ)
        modalQuotePreview.textContent = `"${quote}" — ${author}`; 
    }

    // ===================================
    // 5. モーダル操作関数
    // ===================================

    /**
     * 共有モーダルを開く
     */
    function openShareModal() {
        if (!currentQuoteData) {
            // ★ 口語表現に修正
            showNotification('名言がまだ読み込まれていないみたい...');
            return;
        }

        // テキストを最新の状態に更新してからモーダルを開く
        setupShareText(currentQuoteData);
        
        // モーダルを表示
        shareModal.style.display = 'flex';
        // アニメーションのためクラスを変更
        setTimeout(() => {
            shareModal.classList.remove('modal-leave-to');
        }, 10);
    }

    /**
     * 共有モーダルを閉じる
     */
    function closeShareModal() {
        shareModal.classList.add('modal-leave-to');
        setTimeout(() => {
            shareModal.style.display = 'none';
        }, 300);
    }


    // ===================================
    // 6. メイン機能 (表示とシェア)
    // ===================================

    /**
     * 取得した名言をHTMLに表示し、データを更新する (ページロード時専用)
     */
    function displayQuote() {
        const quoteData = getRandomQuote();
        currentQuoteData = quoteData; // ★ 現在の名言データを保持

        // --- STEP 1: テキストの入れ替えと表示 ---
        quoteTextElement.textContent = quoteData.quote;
        quoteAuthorElement.textContent = `— ${quoteData.author}`;
        
        // タグの表示 
        displayTags(quoteData.tags);

        // 解説文をデータから直接取得し、表示
        explanationTextElement.textContent = quoteData.explanation.trim();

        // レコメンドリンクの更新
        updateRecommendation(quoteData);

        // 初回ロード時はフェードイン演出は省略し、即時表示
        quoteTextElement.style.opacity = 1;
        quoteAuthorElement.style.opacity = 1;
        tagsContainer.style.opacity = 1; 
        recommendationArea.style.opacity = 1;
        explanationTextElement.style.opacity = 1;
    }
    
    /**
     * 名言と解説をWeb Share APIまたは共有モーダルで共有する
     */
    async function handleShareClick() {
        if (!currentQuoteData) {
            // ★ 口語表現に修正
            showNotification('名言がまだ読み込まれていないみたい...');
            return;
        }

        // 共有テキストを先にセットアップ (shortShareTextにはURLを含まない)
        setupShareText(currentQuoteData); 
        
        const isShareAvailable = navigator.share && window.isSecureContext;

        if (isShareAvailable) {
            try {
                // 1. ネイティブ共有を試みる
                await navigator.share({
                    title: '今日の名言と解説', 
                    // shortShareTextは口語CTAを含むが、URLは含めない
                    text: shortShareText, 
                    url: FIXED_SHARE_URL 
                });
                // 成功したら終了
                return;
            } catch (error) {
                // AbortError (ユーザーキャンセル) やその他のエラーの場合、フォールバックとしてモーダルを開く
                if (error.name !== 'AbortError') {
                    console.error("Native Share Error:", error);
                }
                // 処理を継続し、カスタムモーダルを開く
            }
        }
        
        // 2. Native Shareが使えない、またはキャンセル・失敗した場合、カスタムモーダルを開く
        openShareModal();
    }

    /**
     * Twitterでシェアする (JSでウィンドウを開く)
     */
    function shareOnTwitter() {
        if (!currentQuoteData) return;
        
        // shortShareText（口語CTAを含む）をエンコードし、URLは別途urlパラメータで渡す
        const twitterText = encodeURIComponent(shortShareText);
        
        // Twitter Intent: textに本文、urlに固定URL
        const twitterUrl = `https://twitter.com/intent/tweet?text=${twitterText}&url=${encodeURIComponent(FIXED_SHARE_URL)}`;
        
        window.open(twitterUrl, '_blank', 'noopener,noreferrer');
        closeShareModal();
    }

    /**
     * LINEでシェアする (JSでウィンドウを開く) (口語表現のテキストとURL)
     */
    function shareOnLine() {
        if (!currentQuoteData) return;

        // shortShareText（口語CTAを含む）に、固定URLを結合してLINEに渡す
        const lineShareTextWithUrl = `${shortShareText}\n${FIXED_SHARE_URL}`;
        
        const lineTextEncoded = encodeURIComponent(lineShareTextWithUrl);
        
        // 公式LINE共有URLにテキストを渡す
        const lineUrl = `https://social-plugins.line.me/lineit/share?text=${lineTextEncoded}`;

        window.open(lineUrl, '_blank', 'noopener,noreferrer');
        closeShareModal();
    }


    // ===================================
    // 7. イベントリスナーと初期化
    // ===================================

    // ★★★ 変更点: 「新しい名言を生成」ボタンはページ全体をリロードする ★★★
    generateBtn.addEventListener('click', () => {
        // 広告表示機会を増やすため、ページ全体をリロードします
        window.location.reload(); 
    });

    // 「名言をシェア」ボタン 
    shareBtn.addEventListener('click', handleShareClick);

    // モーダル関連イベントリスナー
    closeModalBtn.addEventListener('click', closeShareModal);
    
    // モーダル外クリックで閉じる
    shareModal.addEventListener('click', (e) => {
        if (e.target === shareModal) {
            closeShareModal();
        }
    });

    // Twitterボタンのクリックイベント
    shareTwitterBtn.addEventListener('click', shareOnTwitter);

    // LINEボタンのクリックイベント
    shareLineBtn.addEventListener('click', shareOnLine);


    // モーダル内の「テキストをコピー」ボタン
    copyTextBtn.addEventListener('click', async () => {
        // fullShareTextはopenShareModalで設定済み（解説文、ハッシュタグ、固定URLを含む長文）
        const success = await copyToClipboard(fullShareText); 
        if (success) {
            closeShareModal(); // コピー成功後にモーダルを閉じる
        }
    });


    // ページロード時に最初の名言を表示 (リロード時も実行される)
    document.addEventListener('DOMContentLoaded', displayQuote);

</script>

</body>
</html>

